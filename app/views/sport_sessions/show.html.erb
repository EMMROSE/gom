<div class="sport-session-background" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('<%= cl_image_path @sport_session.activity.photo.key %>');">


  <div class="sport-session-card" style="">
    <div class="sport-session-card-left">
      <h1 class="text-center sport-session-title"><%= image_tag ("#{@sport_session.activity.name.downcase}-picto.png") %><%= @sport_session.title %></h1>
      <p class="text-center"><%=  @sport_session.description %></p>
      <div class="session-members">
        <% accepted_users_count = 1 %> <!-- Start at 1 to count the session owner -->
        <% pending_users_count = 0 %>
        <% @relevant_session_users.each do |session_user| %>

          <!-- Differenciate session owner -->
          <% if session_user.owner %>
            <div class="session-member text-center">
              <%= cl_image_tag session_user.user.photo.key, class: "avatar-large d-block avatar-owner" %>
              <b><%= @sport_session_owner == current_user ? "You" : @sport_session_owner.username %></b><br><span class="owner">Owner</span>
            </div>
          <% else %>

          <!-- Differenciate accepted session members -->
            <% if session_user.status == "accepted" %>
              <div class="session-member text-center">
                <%= cl_image_tag session_user.user.photo.key, class: "avatar-large d-block"%>
                <%= session_user.user == current_user ? "You" : session_user.user.username %>
                <% accepted_users_count += 1 %>
              </div>

            <!-- Differenciate pending requests session members -->
            <% elsif session_user.status == "pending" %>
              <div class="session-member text-center pending-member">
                <%= cl_image_tag session_user.user.photo.key, class: "avatar-large d-block"%>
                <%= session_user.user == current_user ? "You" : session_user.user.username %><br><span class="pending">Pending</span>
                <% pending_users_count += 1 %>
              </div>
            <% end %>
          <% end %>
        <% end %>

        <!-- Adding placeholders for remaining places -->
        <% (@sport_session.capacity - (accepted_users_count + pending_users_count)).times do %>
          <%= image_tag('avatar-placeholder.jpg', class: "avatar-large avatar-placeholder") %>
        <% end %>
      </div>

      <div class="sport-session-info">
        <div class="sport-session-info-left">
          <ul class="list-unstyled">
            <li><i class="fas fa-calendar-alt"></i> <%= @sport_session.start_time.strftime("%-d %b %Y") %></li>
            <li><b>Level:</b> <%= @sport_session.level %></li>
            <li><i class="fas fa-map-marker-alt"></i> <%= @sport_session.location %></li>
          </ul>
        </div>
        <div class="sport-session-join">
          <!-- Show "join" option only if you are not owner of the sport session -->
          <% if @sport_session_owner != current_user %>

            <!-- Show "join" option only if session is not complete -->
            <% if @sport_session.users.count < @sport_session.capacity %>

              <!-- Show "pending request", if you already requested to join this session -->
              <% if @current_relevant_session_user && @current_relevant_session_user.status == "pending" %>
                <span class="btn w-100 btn-pending">REQUEST PENDING...</span>

              <!-- Show "join" option  -->
              <% else %>
                <%= link_to "Ask to Join!", sport_session_session_users_path(params[:id]), method: "post", class: "btn btn-gom w-100" %>
              <% end %>

            <!-- Show "session complet" if session is complete  -->
            <% else %>
              <span class="btn w-100 btn-complete">SESSION COMPLETE</span>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="sport-session-card-right">
      <div class="chatroom-container">
        <h2 class="text-center">#chat</h2>
        <div class=<%= @current_relevant_session_user && @current_relevant_session_user.status == "accepted" ? "" : 'blur-chatroom' %>>
          <div id="messages" data-sport-session-id="<%= @sport_session.id %>">
            <% if @sport_session.messages %>
              <% @sport_session.messages.each do |message| %>
                <div class="message-container" id=<%= "message-author" if current_user == message.user %>>
                  <i class="author">
                    <span><%= message.user.username %></span>
                    <small><%= message.created_at.strftime("%a %b %e at %l:%M%p") %></small>
                  </i>
                  <p><%= message.content %></p>
                </div>
              <% end %>
            <% end %>
          </div>
          <%= simple_form_for [ @sport_session, @message ], remote: true do |f| %>
            <%= f.input :content, label: false, placeholder: "Message #Chat" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
